#Steps template for Static WebApps export
parameters:
  - name: env
    type: string

  - name: contractID
    type: number
    default: 1

  - name: clientName
    displayName: Name of Client to build
    type: string
    default: ""

  - name: ignore
    type: boolean
    default: false

steps:
  - task: Npm@1
    displayName: "Build FO Static WebSite"
    inputs:
      command: "custom"
      customCommand: "run build"
    env:
      NEXT_PUBLIC_API_URL: https://func-msd-${{ parameters.env }}-foapi.azurewebsites.net/api
      NEXT_PUBLIC_USER_API_URL: https://app-msd-${{ parameters.env }}-useraccount.azurewebsites.net
      COOKIE_BOT_CBID: $(COOKIE_BOT_CBID)
      NEXT_PUBLIC_CONTRACT_ID: ${{ parameters.contractID }}
      NEXT_PUBLIC_BASE_PATH: ${{ parameters.clientName }}
      NODE_ENV: "production"
    condition: not(${{ parameters.ignore }})

  - task: Npm@1
    displayName: "Export FO Static Website assets"
    inputs:
      command: "custom"
      customCommand: "run export"
    env:
      NEXT_PUBLIC_API_URL: https://func-msd-${{ parameters.env }}-foapi.azurewebsites.net/api
      NEXT_PUBLIC_USER_API_URL: https://app-msd-${{ parameters.env }}-useraccount.azurewebsites.net
      COOKIE_BOT_CBID: $(COOKIE_BOT_CBID)
      NEXT_PUBLIC_CONTRACT_ID: ${{ parameters.contractID }}
      NEXT_PUBLIC_BASE_PATH: ${{ parameters.clientName }}
      NODE_ENV: "production"
    condition: not(${{ parameters.ignore }})
